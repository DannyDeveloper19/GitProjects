function Icon () {
  if ($('#form_register').is(':visible')) {
    $('#show_register').html("<i class='fa fa-arrow-circle-down'></i>  Register")
  }else {
    $('#show_register').html("<i class='fa fa-arrow-circle-right'></i>  Register")
  }
  if ($('#form_credentials').is(':visible')) {
    $('#show_credentials').html("<i class='fa fa-arrow-circle-down'></i>  Credentials")
  }else {
    $('#show_credentials').html("<i class='fa fa-arrow-circle-right'></i>  Credentials")
  }
  if ($('#form_picture').is(':visible')) {
    $('#show_picture').html("<i class='fa fa-arrow-circle-down'></i>  Picture")
  }else {
    $('#show_picture').html("<i class='fa fa-arrow-circle-right'></i>  Picture")
  }
}

/* function exists (params) {
  $.ajax({
    type: 'GET',
    url: 'PHP_MVC/Account/exists/' + params,
    success: function (response) {
      if (response == '\r\n1') {
        $('#username').removeClass('is-valid')
        $('#username').addClass('is-invalid')
        $('#username_notice').attr('class', 'invalid-feedback')
        $('#username_notice').html('<i class="fa fa-ban" aria-hidden="true"></i> Username already exists, type another')
      }else {
        $('#username').removeClass('is-invalid')
        $('#username').addClass('is-valid')
        $('#username_notice').attr('class', 'notice-feedback')
        $('#username_notice').html('<i class="fa fa-exclamation-triangle"></i> Use the username of your email: username@example.com')
      }
    }
  })
} */

function userLogin (data) {
  var user = $('form[name=Session] input[name=username]').val()
  var pass = $('form[name=Session] input[name=password]').val()
  if (user == '') {
    $('#userlogin').removeClass('is-valid')
    $('#userlogin').addClass('is-invalid')
    $('#userValidate').attr('class', 'invalid-feedback')
    $('#userValidate').html('Username field required')
  }
  if (pass == '') {
    $('#passlogin').removeClass('is-valid')
    $('#passlogin').addClass('is-invalid')
    $('#passValidate').attr('class', 'invalid-feedback')
    $('#passValidate').html('Password field required')
  }else {
    $('#error-message').hide()
    $('#passlogin').removeClass('is-invalid')
    $('#passlogin').addClass('is-invalid')
    $('#passValidate').html('')
    $.ajax({
      type: 'POST',
      url: '/PHP_MVC/Account/login/0',
      data: data,
      success: function (response) {
        if (response == 1) {
          $('#userlogin').addClass('is-invalid')
          $('#userValidate').attr('class', 'invalid-feedback')
          $('#userValidate').html('Username not matched')
        }
        else if (response == 0) {
          $('#passlogin').addClass('is-invalid')
          $('#passValidate').attr('class', 'invalid-feedback')
          $('#passValidate').html('Password incorrect')
        } else {
          document.location = response
        }
      }
    })
  }
}

$(document).ready(function () {
  Icon()
  function RefreshCamera () {
    if (windowCapture.closed) {
      $('.overlay').hide()
    }else {
      setTimeout(RefreshCamera, 1000)
    }
  }
  if (typeof (Storage) && localStorage.getItem('url') != null) {
    $('#form_picture').show()
    $('#img_load').attr('src', '/PHP_MVC' + localStorage.getItem('url'))
    $('#livepicture').val('.' + localStorage.getItem('url'))
  }
  $('#capture_picture').on('click', function () {
    $('.overlay').show()
    windowCapture = window.open('/PHP_MVC/Account/capture/1', 'Live Camera', 'with=700,height=500')
    RefreshCamera()
  })

 /*  $('#session-sign-in').on({
    click: function (e) {
      e.preventDefault()
      var data = $('#Session').serialize()
      userLogin(data)
    }
  }) */
  $('#userlogin').focus(function (e) {
    e.preventDefault()
    $('#userValidate').html('')
  })
  $('#passlogin').focus(function (e) {
    e.preventDefault()
    $('#passValidate').html('')
  })

  $('#show_register').on('mousedown', function () {
    $('#form_register').toggle(500, function () {
      Icon()
    })
  })

  $('#show_credentials').on('mousedown', function () {
    $('#form_credentials').toggle(500, function () {
      Icon()
    })
  })

  $('#show_picture').on('mousedown', function () {
    $('#form_picture').toggle(500, function () {
      Icon()
    })
  })

  /* $('#username').keyup(function (e) {
    var text = $(this).val()
    exists(text)
  }) */

  $('#cancel').click(function (e) {
    e.preventDefault()
    if (confirm('Do you really want to cancel this operation?')) {
      localStorage.removeItem('url')
      window.history.back()
    }
  })
  $('#sign-out').click(function (e) {
    e.preventDefault()
    if (confirm('Are you sure to want to leave?')) {
      $.get('PHP_MVC/Account/destroySession/0',
        function (data, textStatus, jqXHR) {
          document.location = data
        })
    }
  })

  $('#phone').keydown(function (e) {
    if ($(this).val().length == 1) {
      var text = $(this).val()
      $(this).val('(' + text)
    }else if ($(this).val().length == 4) {
      var text = $(this).val()
      $(this).val(text + ')')
    }else if ($(this).val().length == 8) {
      var text = $(this).val()
      $(this).val(text + '-')
    }
  })
  $('#txt_reset').keyup(function (e) { 
    if ($('#resetByText').is(':checked')){
      if ($(this).val().length == 1) {
        var text = $(this).val()
        $(this).val('(' + text)
      } else if ($(this).val().length == 4) {
        var text = $(this).val()
        $(this).val(text + ')')
      } else if ($(this).val().length == 8) {
        var text = $(this).val()
        $(this).val(text + '-')
      }
    }
  });

  $('button.remove').click(function (e) { 
    e.preventDefault();
    var id = $(this).attr('id')
    if(confirm('Are you sure you want to remove this user?')){
      $.ajax({
        type: "GET",
        url: "PHP_MVC/Guess/remove/"+id,
        success: function (response) {
          if(response !='\r\n2'){
            alert("User removed")
            document.location = response
          }else {
            alert("user no removed")
          }
        }
      });
    }
    
  });
})
